

<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="css/text" href="todos.css"/>
	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
	<script type="text/x-handlebars-template">
 	(function (exports) {

     	var UI = {
         	tasks: $("#tasks"),
         	text: $("#txt")
     	};
     
     	var todoTemplate = Handlebars.compile($('#todos').html());   
     	var toDoList = [];
     	var data = {"tasks": toDoList };
 
     	var Task = function (id, text, done) {
         	this.id = id;
         	this.text = text;
         	this.done = done;
     	};

   
     	function addNewTask() {

         	var text = UI.text.val();
         	var done = false;
         	var id = toDoList.length;
         	var newTask = new Task(id, text, done);
         
         	if (newTask.text !== "") {
             	toDoList.push(newTask);
             	UI.text.val("");
             	displayTodos();
         	}
         
         	showProgress();
     	}

     	UI.tasks.on("click", "input", function(event) {
                 var todoId = $(this).closest("div").data("id");
                 toDoList[todoId].done = !toDoList[todoId].done;          
                 $(this).closest("div").toggleClass("done");
                 showProgress();
                 return false;
     	});

     	UI.tasks.on("click", ".delete", function(event) {
                 var todoId = $(this).closest("div").data("id");
                 
                 /*$.each(toDoList, function(item){
                        if(item.id === todoId) {
                            item.deleted = true;
                            displayTodos();
                            showProgress();
                        }
                 });*/
                for (var i = 0; i<toDoList.length; i++) {
                    if (toDoList[i].id === todoId) {
                        todoList[i].deleted = true;
                        displayTodos();
                        showProgress();
                    }
                }  
                 return false;

    	});
     
     	function displayTodos() {
         	var hbrs_text = todoTemplate(data);
         	UI.tasks.html(hbrs_text);
     	}
     
 
     	var trueOrFalse = true;
     
     	function selectAll() {

         	$.each(toDoList, function(item) {
            	item.done = trueOrFalse;
            	UI.tasks.find('input').prop("checked", trueOrFalse);
            	UI.tasks.closest("div").toggleClass("done");
               
         	});

         	trueOrFalse=!trueOrFalse;
         	showProgress();
        
     	}

     	function deleteDone() {
         	$.each(toDoList, function(item) {
             	if(item.done) {
                 	item.done = false;
                 	item.deleted = true;
             	}
         	});
         	showProgress();
     	}
     
     
     	function showProgress() {
         	var nd;
         	var totalClass;
         	var deleted = 0;
         	var n = $( "input:checked" ).length;

         	$.each(toDoList, function(item) {
            	if(item.deleted){
                	deleted++;
            	}
         	});


         	var totalTasks = toDoList.length;
         	if (deleted === totalTasks) {
             	totalClass = "emptyList";
             	nd = "Enter a task!";
             	deleted = 0;
             	totalTasks = 0;
         	} else {
             	var temp = totalTasks - deleted;
             	nd = "Done: " + n + " out of " + temp;
             	totalClass = "inList";
         	}
        
         
         	$("#total").text(nd).removeClass().addClass(totalClass);
     	}

     	$("#addButton").click(addNewTask);
     	$("#selectAll").click(selectAll);
     	$("#deleteDone").click(deleteDone);

 		}(window));
	</script>
</head>
<body>
    <header>My ToDo list</header>
    <article id="main">
        <div id = "primarybox">
        <input type="text" id="txt" placeholder="Enter your task here" value="" />
        <button type="button" id="addButton">Add task</button>
            <button type="button" id="selectAll">Select/Clear All</button>
        <button type="button" id="deleteDone">Delete Done</button>
            <div id="tasks"></div>
            <script id="todos" type="text/x-handlebars-template">  
                {{#each tasks}} 
                {{#unless deleted}}
                <div class="{{#if done}}done{{/if}}" data-id="{{id}}" > 
                        <label><input type = "checkbox" value = "{{text}}"  /><span  data-class = "{{done}}">{{text}}</span></label><button class="normal delete">X</button>      
                     </div>
                {{/unless}}
                {{/each}} 
            </script>
        </div>
    </article>
    <p id="total" class="emptyList">Enter a task!</p>
    
</body>
<!-- Requirements:1. You have a list of Todos. 2. I should be able to add and remove them. 3. I can mark a todo as done. 4. I have a way of selecting all the items. 5. I see a total at the bottom of my todos: done/total. -->
</html>